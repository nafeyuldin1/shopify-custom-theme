{% comment %} list-image.liquid {% endcomment %}

<style>
    .customstyle{{ section.id }} .list-image-item{
        padding: 0px 15px;
    }
    /* Fix for slider initialization flicker */
    .list-image-content:not(.slick-initialized) {
        display: flex;
        overflow: hidden;
    }
</style>

<div class="customstyle{{ section.id }}" data-aos={{section.settings.animation}}>
    {%- render 'style-section' -%}
    <div class="{{ section.settings.setwidth }}">
        <div class="list-image">
            {%- render 'section-heading' -%}
            
            {% comment %} 
              HTML Container for Slider 
            {% endcomment %}
            <div class="list-image-content list-image-slider-{{ section.id }}" 
            id="list-image-{{ section.id }}"
            data-rows="{{ section.settings.rows }}"
            data-slidesToShow="{{ section.settings.show }}"
            data-mobile="{{ section.settings.show_mobile }}" 
            data-arrows="{{ section.settings.arrows }}"
            data-dots="{{ section.settings.dots }}" 
            data-draggable="{{ section.settings.draggable }}" 
            data-infinite="{{ section.settings.infinite }}">
            
            {%- for block in section.blocks -%}
                {%- case block.type -%}
                {%- when 'image_item' -%}
                
                <div class="list-image-item" id="block-{{ block.id }}">
                    <style>
                        /* Existing Pin Position Style */
                        #block-{{ block.id }} .product-hover-product{
                            position:absolute;
                            top:{{ block.settings.top }}%;
                            left:{{ block.settings.left }}%;
                        }

                        /* Image Radius */
                        #block-{{ block.id }} .items-content img,
                        #block-{{ block.id }} .items-content svg {
                            border-radius: {{ block.settings.image_radius }}px;
                            display: block;
                            width: 100%;
                        }

                        /* Title Typography */
                        #block-{{ block.id }} .list-image-title {
                            font-size: {{ block.settings.title_fontsize }}px;
                            color: {{ block.settings.title_color }};
                            margin-top: 15px;
                            text-align: center;
                            font-weight: 500;
                            line-height: 1.2;
                        }
                    </style>
                    <div class="items-content position-relative">
                        {% if block.settings.image != blank %}
                            <img src="{{ block.settings.image | image_url: width: 1920 }}" width="auto" height="auto" loading="lazy" alt="{{ block.settings.image.alt }}">
                        {%- else -%}
                            {{ 'image' | placeholder_svg_tag: 'placeholder-svg' }}
                        {% endif %}
                        
                        {% if block.settings.product != blank %}
                        <div class="product-hover-product d-none d-lg-block">
                            <div class="product-hover-icon">
                            <svg class="icon-open" xmlns="http://www.w3.org/2000/svg" width="13" height="13" viewBox="0 0 13 13" fill="none">
                                <path d="M6 7V13H7V7H13V6H7V0H6V6H0V7H6Z" fill="black"/>
                            </svg>
                            <svg class="icon-close" xmlns="http://www.w3.org/2000/svg" width="20" height="2" viewBox="0 0 20 2" fill="none">
                                <path d="M8.74229e-08 2L0 9.53674e-07L20 0V2L8.74229e-08 2Z" fill="black"/>
                                </svg>
                            </div>
                            <div class="product-hover-product-content">
                            {%- render 'product-card', product: block.settings.product -%}
                            </div>
                        </div>
                        {% endif %}
                    </div>
                    
                    {% if block.settings.title_text != blank %}
                        <div class="list-image-title">
                            {{ block.settings.title_text }}
                        </div>
                    {% endif %}

                </div>
                {% endcase %}
            {% endfor %}
            </div>
        </div>
    </div>
</div>

{% comment %} 
  JAVASCRIPT FIX: This script forces the slider to respect the mobile setting 
{% endcomment %}
<script>
document.addEventListener("DOMContentLoaded", function() {
    function initSlick{{ section.id | replace: '-', '' }}() {
        var $slider = $('#list-image-{{ section.id }}');
        
        // Settings variables
        var rows = $slider.data('rows');
        var desktopShow = $slider.data('slidestoshow');
        var mobileShow = $slider.data('mobile'); // Setting from schema
        var arrows = $slider.data('arrows');
        var dots = $slider.data('dots');
        var infinite = $slider.data('infinite');
        var draggable = $slider.data('draggable');

        // Check if slick is already initialized to avoid conflict, then destroy it
        if ($slider.hasClass('slick-initialized')) {
            $slider.slick('unslick');
        }

        // Initialize Slick with Responsive Breakpoints
        $slider.slick({
            rows: rows,
            slidesToShow: desktopShow,
            slidesToScroll: 1,
            arrows: arrows,
            dots: dots,
            infinite: infinite,
            draggable: draggable,
            responsive: [
                {
                    breakpoint: 1024,
                    settings: {
                        slidesToShow: desktopShow,
                        slidesToScroll: 1
                    }
                },
                {
                    breakpoint: 767, /* Mobile Breakpoint */
                    settings: {
                        slidesToShow: mobileShow, /* Uses your new setting */
                        slidesToScroll: 1
                    }
                }
            ]
        });
    }

    // Initialize on load
    // Using setTimeout to ensure jQuery is loaded
    setTimeout(function(){
        if (typeof $ !== 'undefined') {
            initSlick{{ section.id | replace: '-', '' }}();
        }
    }, 100);

    // Re-initialize when Shopify Theme Editor updates (for live preview)
    if (Shopify.designMode) {
        document.addEventListener('shopify:section:load', function(event) {
            if (event.detail.sectionId === '{{ section.id }}') {
                initSlick{{ section.id | replace: '-', '' }}();
            }
        });
    }
});
</script>

{% schema %}
{
    "name": "List image",
    "class": "index-section",
    "settings": [
        {
            "type": "select",
            "id": "animation",
            "options": [
            { "value": "", "label": "None"},
            { "value": "fade", "label": "Fade"},
            { "value": "fade-up", "label": "Fade Up"},
            { "value": "fade-down", "label": "Fade Down"},
            { "value": "fade-left", "label": "Fade Left"},
            { "value": "fade-right", "label": "Fade Right"},
            { "value": "slide-up", "label": "Slide Up"}
            ],
            "label": "Select Animation"
        },
        {
            "type": "text",
            "id": "paddingsection",
            "label": "Padding Section",
            "default": "0px 0px 0px 0px"
        },
        {
            "type": "text",
            "id": "paddingmobile",
            "label": "Padding Section Mobile",
            "default": "60px 0px 60px 0px"
        },
        {
            "type": "text",
            "id": "marginsection",
            "label": "Margin Section",
            "default": "0px 0px 0px 0px"
        },
        {
            "type": "text",
            "id": "marginmobile",
            "label": "Margin Mobile",
            "default": "0px 0px 0px 0px"
        },
        {
            "type": "select",
            "id": "setwidth",
            "label": "Full Width",
            "default": "container",
            "options": [
            { "value": "container", "label": "Box" },
            { "value": "container-fluid", "label": "Container Fluid" },
            { "value": "full", "label": "Full" }
            ]
        },
        {
            "type": "color",
            "id":"bgsection",
            "label":"Background color",
            "default":"transparent"
        },
        {
            "type": "image_picker",
            "id":"bg_image",
            "label":"Background image"
        },
        {
            "type": "header",
            "content": "Text Heading"
        },
        {
            "type": "image_picker",
            "id": "image_header",
            "label": "Image header"
        },
        {
            "type": "text",
            "id": "title_top",
            "label": "Sub Title Top",
            "default": "Sub Title Top"
        },
        {
            "type": "text",
            "id": "title",
            "label": "Title",
            "default": "Custom content"
        },
        {
            "type": "textarea",
            "id": "des",
            "label": "HTML / Description"
        },
        {
            "type": "select",
            "id": "align-heading",
            "label": "Align Heading",
            "default": "center",
            "options": [
                { "value": "center", "label": "Center" },
                { "value": "left", "label": "Left" },
                { "value": "right", "label": "Right" }
            ]
        },
        {
            "type":"header",
            "content":"Settings Carousel"
        },
        {
            "type": "checkbox",
            "id": "arrows",
            "label": "Arrows",
            "default": true
        },
        {
            "type": "checkbox",
            "id": "draggable",
            "label": "Draggable",
            "default": true
        },
        {
            "type": "checkbox",
            "id": "dots",
            "label": "Dots",
            "default": true
        },
        {
            "type": "checkbox",
            "id": "infinite",
            "label": "Infinite",
            "default": true
        },
        {
            "type": "select",
            "id": "rows",
            "label": "Rows",
            "default": "1",
            "options": [
                { "value": "1", "label": "1 row" },
                { "value": "2", "label": "2 rows" }
            ]
        },
        {
            "type": "range",
            "id": "show",
            "min": 2,
            "max": 6,
            "step": 1,
            "label": "Display items (Desktop)",
            "default": 3
        },
        {
            "type": "range",
            "id": "show_mobile",
            "min": 1,
            "max": 3,
            "step": 1,
            "label": "Display items (Mobile)",
            "default": 1
        }
    ],
    "blocks": [
        {
            "type": "image_item",
            "name": "Image",
            "settings": [
                {
                    "type": "image_picker",
                    "id": "image",
                    "label": "Image"
                },
                {
                    "type": "range",
                    "id": "image_radius",
                    "min": 0,
                    "max": 100,
                    "step": 1,
                    "unit": "px",
                    "label": "Image Radius",
                    "default": 0
                },
                {
                    "type": "text",
                    "id": "title_text",
                    "label": "Block Title",
                    "default": "Your Title Here"
                },
                {
                    "type": "range",
                    "id": "title_fontsize",
                    "min": 10,
                    "max": 50,
                    "step": 1,
                    "unit": "px",
                    "label": "Title Font Size",
                    "default": 16
                },
                {
                    "type": "color",
                    "id": "title_color",
                    "label": "Title Color",
                    "default": "#000000"
                },
                {
                    "type":"product",
                    "id":"product",
                    "label":"Product"
                },
                {
                    "type": "range",
                    "id": "top",
                    "min": 0,
                    "max": 100,
                    "step": 1,
                    "unit": "%",
                    "label": "Top",
                    "default": 30
                },
                {
                    "type": "range",
                    "id": "left",
                    "min": 0,
                    "max": 100,
                    "step": 1,
                    "unit": "%",
                    "label": "Left",
                    "default": 60
                }
            ]
        }
    ],
    "presets": [
        {
            "name": "List image",
            "blocks": [
                { "type": "image_item" },
                { "type": "image_item" }
            ]
        }
    ]
}
{% endschema %}